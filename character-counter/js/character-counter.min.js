function counterLocalization(){return{warning:"Maximum Length",max:"Max: ",min:"Min: "}}function sanitize(e){e.field=e.field?e.field.trim():"",e.repeatable=e.repeatable?e.repeatable.trim():"",e.editable=e.editable?e.editable.trim():"",e.max=e.max?parseInt(e.max):"",e.min=e.min?parseInt(e.min):"",e.type=e.type?e.type.trim().toLowerCase():"",e.show=e.show?e.show.trim().toLowerCase():"",e.label=e.label?e.label:"",e.enforce_max=!!e.enforce_max,e.count=0,""===e.max&&(e.type="up"),initCounter(e)}function initCounter(e){if(e.repeatable){let t=document.getElementById(`f_${e.repeatable}`),n=`.k_element_${e.editable} input`,i=t.querySelectorAll(n);if(!i.length){const i=new MutationObserver(function(){let a=t.querySelectorAll(n).item(0);initRepeatable(e,a),i.disconnect()});i.observe(t,{subtree:!0,childList:!0})}for(let t of i)initRepeatable(e,t);document.getElementById(`addRow_f_${e.repeatable}`).addEventListener("click",function(){let i=t.querySelectorAll(n),a=i.item(i.length-1);initRepeatable(e,a)})}else{let t=e.field||`f_${e.editable}`;e.target=document.getElementById(t),console.log(t),instantiateCounter(e)}}function initRepeatable(e,t){instantiateCounter({max:e.max,min:e.min,type:e.type,show:e.show,label:e.label,enforce_max:e.enforce_max,count:0,target:t})}function instantiateCounter(e){const t=counterLocalization();e.target.addEventListener("keyup",function(){refreshCount(e)}),e.target.addEventListener("keydown",function(){refreshCount(e)}),e.id=`${e.target.id}_counter`;let n=document.createElement("p");n.setAttribute("id",e.id),n.style.textAlign="right",e.target.parentNode.appendChild(n),e.element=document.getElementById(e.id),e.element.innerHTML=`<span>${e.count}</span>`,e.min&&(e.show.indexOf("min")>=0||e.show.indexOf("both")>=0)&&(e.element.innerHTML=`${t.min} ${e.min} &nbsp; ${e.element.innerHTML}`),e.max&&(e.show.indexOf("max")>=0||e.show.indexOf("both")>=0)&&(e.element.innerHTML=`${e.element.innerHTML}&nbsp;&nbsp;&nbsp;${t.max} ${e.max}`),e.element.innerHTML=`${e.label} ${e.element.innerHTML}`,e.enforce_max&&(e.element.innerHTML=`<span style="color:red;">${t.warning}</span> ${e.element.innerHTML}`),e.warning=e.enforce_max?e.element.children[0]:null,e.counter=e.enforce_max?e.element.children[1]:e.element.children[0],refreshCount(e)}function refreshCount(e){e.enforce_max&&(e.target.value.length>=e.max?(e.target.value=e.target.value.slice(0,e.max),e.warning.style.visibility="visible"):e.warning.style.visibility="hidden"),"up"===e.type?e.count=e.target.value.length:e.count=e.max-e.target.value.length,e.counter.innerHTML=e.count,"up"===e.type?e.max&&e.count>e.max||e.count<e.min?e.counter.style.color="red":e.max&&e.count>.9*e.max?e.counter.style.color="darkorange":e.counter.style.color="green":e.min&&e.target.value.length<e.min||e.count<0?e.counter.style.color="red":e.target.value.length>.9*e.max?e.counter.style.color="darkorange":e.counter.style.color="green"}my_counters.forEach(sanitize);